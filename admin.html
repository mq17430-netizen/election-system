<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ - Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ù†Ø¸Ø§Ù…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f4f6fb;
            min-height: 100vh;
        }

        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 20px 40px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .top-left a {
            font-size: 13px;
            text-decoration: none;
            color: #555;
        }

        .top-left a:hover {
            text-decoration: underline;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00c853, #1a9bff);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 22px;
        }

        .admin-text .title {
            font-size: 16px;
            font-weight: 700;
        }

        .admin-text .welcome {
            font-size: 12px;
            color: #777;
        }

        .card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 18px rgba(15, 34, 58, 0.08);
            padding: 18px 20px;
            margin-bottom: 16px;
        }

        .card-header {
            margin-bottom: 10px;
        }

        .card-header h2 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .card-header p {
            font-size: 12px;
            color: #777;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .form-group {
            flex: 1;
            min-width: 180px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 3px;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #dde2ef;
            font-size: 13px;
            outline: none;
        }

        .form-group input:focus {
            border-color: #1a9bff;
            box-shadow: 0 0 0 3px rgba(26,155,255,0.12);
        }

        .code-box input {
            font-family: "Consolas", monospace;
            text-align: center;
            font-weight: 700;
        }

        .btn-primary {
            margin-top: 16px;
            padding: 9px 22px;
            border-radius: 14px;
            border: none;
            background: linear-gradient(90deg, #00c853, #1a9bff, #0066ff);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 18px rgba(0, 102, 255, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
        }

        .hint {
            font-size: 11px;
            color: #999;
            margin-top: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 10px;
        }

        th, td {
            padding: 8px 6px;
            border-bottom: 1px solid #edf0f7;
            text-align: center;
        }

        th {
            font-size: 12px;
            color: #777;
        }

        tbody tr:hover {
            background: #fafbff;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 12px;
            background: #f1f3fa;
        }

        .action-icon {
            cursor: pointer;
            font-size: 16px;
        }

        .no-data {
            text-align: center;
            font-size: 12px;
            color: #888;
            padding: 8px 0;
        }

        @media (max-width: 700px) {
            .card {
                padding: 14px;
            }
        }
    </style>
</head>
<body>

<div class="page">
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="top-bar">
        <div class="admin-info">
            <div class="admin-icon">ğŸ› ï¸</div>
            <div class="admin-text">
                <div class="title">Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</div>
                <div class="welcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø®ØªØ§Ø± Ù‚Ø§Ø³Ù…</div>
            </div>
        </div>
        <div class="top-left">
            <!-- ØªÙ‚Ø¯Ø± ØªØ±Ø¨Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨ØµÙØ­Ø© login Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ø°Ø§ ØªØ­Ø¨ -->
            <a href="index.html">â¬… Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
        </div>
    </div>

    <!-- ÙƒØ§Ø±Øª Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø¸Ø§Ù… -->
    <div class="card">
        <div class="card-header">
            <h2>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø¸Ø§Ù…</h2>
            <p>Ù…Ù† Ù‡Ù†Ø§ ØªÙˆÙ„Ø¯ Ø­Ø³Ø§Ø¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø±ÙƒØ²ØŒ Ù…Ø´Ø±Ù Ù…Ø­Ø§ÙØ¸Ø©ØŒ ...). ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… + ÙƒÙˆØ¯ Ø¯Ø®ÙˆÙ„ØŒ ÙˆØ¨ÙˆØ§Ø³Ø·ØªÙ‡ ÙŠÙØªØ­ ØµÙØ­ØªÙ‡ Ø§Ù„Ø®Ø§ØµØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙŠÙ†.</p>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)</label>
                <input type="text" id="userNameInput" placeholder="Ù…Ø«Ø§Ù„: basim01" />
            </div>

            <div class="form-group">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="userNoteInput" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø±Ù Ø§Ù„Ø±Ù…ÙŠØ«Ø© / Ù‚Ø¶Ø§Ø¡ ÙƒØ°Ø§" />
            </div>

            <div class="form-group code-box">
                <label>Ø§Ù„ÙƒÙˆØ¯ / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ÙŠØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
                <input type="text" id="userCodeInput" readonly />
            </div>
        </div>

        <button class="btn-primary" id="addUserBtn">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>

        <div class="hint">
            ğŸ”¹ Ø§Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ØŒ ÙˆØ§Ø±Ø³Ù„Ù‡ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨.<br>
            ğŸ”¹ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒØªØ¨ Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ØŒ ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡ Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡ (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙŠÙ†).
        </div>
    </div>

    <!-- ÙƒØ§Ø±Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
    <div class="card">
        <div class="card-header">
            <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù‘ÙÙ„ÙŠÙ†</h2>
            <p>ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase FirestoreØŒ Ù…Ø¹ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ (localStorage).</p>
        </div>

        <div style="overflow-x:auto; margin-top:8px;">
            <table>
                <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th>Ø§Ù„ÙƒÙˆØ¯ / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
                    <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
                </thead>
                <tbody id="usersTableBody">
                </tbody>
            </table>
        </div>
        <div id="noUsersMsg" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯.</div>
    </div>
</div>

<!-- ğŸ”¥ Ø±Ø¨Ø· Firebase + Firestore + Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ / Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
        getFirestore,
        collection,
        getDocs,
        addDoc,
        deleteDoc,
        doc
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDdiudUa5jjcZDwJgYBbLdC-YBNQ5rlqvU",
        authDomain: "election-system-9cbb8.firebaseapp.com",
        projectId: "election-system-9cbb8",
        storageBucket: "election-system-9cbb8.firebasestorage.app",
        messagingSenderId: "886706894008",
        appId: "1:886706894008:web:270556771843614e56b04d"
    };

    const app  = initializeApp(firebaseConfig);
    const db   = getFirestore(app);
    const usersColRef = collection(db, "systemUsers");

    const SYSTEM_USERS_KEY = "systemUsers";

    const userNameInput  = document.getElementById('userNameInput');
    const userNoteInput  = document.getElementById('userNoteInput');
    const userCodeInput  = document.getElementById('userCodeInput');
    const addUserBtn     = document.getElementById('addUserBtn');
    const usersTableBody = document.getElementById('usersTableBody');
    const noUsersMsg     = document.getElementById('noUsersMsg');

    let systemUsers = [];

    function generateUserCode() {
        const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
        const digits  = "0123456789";
        let code = "";
        for (let i = 0; i < 3; i++) {
            code += letters[Math.floor(Math.random() * letters.length)];
        }
        for (let i = 0; i < 2; i++) {
            code += digits[Math.floor(Math.random() * digits.length)];
        }
        return code;
    }

    function resetCodeField() {
        userCodeInput.value = generateUserCode();
    }

    function saveSystemUsersToLocal() {
        localStorage.setItem(SYSTEM_USERS_KEY, JSON.stringify(systemUsers));
    }

    function renderUsersTable() {
        usersTableBody.innerHTML = '';

        if (!systemUsers || systemUsers.length === 0) {
            noUsersMsg.style.display = 'block';
            return;
        }
        noUsersMsg.style.display = 'none';

        systemUsers.forEach((u, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${u.username}</td>
                <td><span class="badge">${u.password}</span></td>
                <td>${u.note || ''}</td>
                <td>
                    <span class="action-icon"
                          data-action="delete"
                          data-index="${index}"
                          title="Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">ğŸ—‘ï¸</span>
                </td>
            `;
            usersTableBody.appendChild(tr);
        });
    }

    async function loadSystemUsersFromFirestore() {
        try {
            const snapshot = await getDocs(usersColRef);
            const result = [];
            snapshot.forEach(docSnap => {
                const data = docSnap.data();
                result.push({
                    id: docSnap.id,
                    username: data.username,
                    password: data.password,
                    note: data.note || ""
                });
            });

            systemUsers = result;
            saveSystemUsersToLocal();
            renderUsersTable();
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firestore:", e);
            try {
                systemUsers = JSON.parse(localStorage.getItem(SYSTEM_USERS_KEY) || "[]");
            } catch {
                systemUsers = [];
            }
            renderUsersTable();
        } finally {
            resetCodeField();
        }
    }

    addUserBtn.addEventListener('click', async () => {
        const username = userNameInput.value.trim();
        const note     = userNoteInput.value.trim();
        const password = userCodeInput.value.trim();

        if (!username) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
            return;
        }

        const exists = systemUsers.some(
            u => u.username.toLowerCase() === username.toLowerCase()
        );
        if (exists) {
            alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ù…Ø³Ø¬Ù‘ÙÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹. Ø§Ø®ØªØ± Ø§Ø³Ù…Ø§Ù‹ Ø¢Ø®Ø±.');
            return;
        }

        try {
            const docRef = await addDoc(usersColRef, {
                username,
                password,
                note
            });

            systemUsers.push({
                id: docRef.id,
                username,
                password,
                note
            });

            saveSystemUsersToLocal();
            renderUsersTable();

            userNameInput.value = '';
            userNoteInput.value = '';
            resetCodeField();

            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­. Ù„Ø§ ØªÙ†Ø³Ù ØªØ³Ù„ÙŠÙ… Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨.');
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Firestore:", e);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.');
        }
    });

    usersTableBody.addEventListener('click', async (e) => {
        const action = e.target.dataset.action;
        if (action !== 'delete') return;

        const index = parseInt(e.target.dataset.index, 10);
        if (isNaN(index) || !systemUsers[index]) return;

        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;

        const user = systemUsers[index];

        try {
            if (user.id) {
                await deleteDoc(doc(db, "systemUsers", user.id));
            }
            systemUsers.splice(index, 1);
            saveSystemUsersToLocal();
            renderUsersTable();
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore:", e);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
        }
    });

    loadSystemUsersFromFirestore();
</script>

</body>
</html>
