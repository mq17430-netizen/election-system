<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ - Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ù†Ø¸Ø§Ù…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Cairo',sans-serif;background:#f4f6fb;}
        .page{max-width:1200px;margin:0 auto;padding:20px;}
        .top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .admin-info{display:flex;align-items:center;gap:10px;}
        .admin-icon{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#00c853,#1a9bff);color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;}
        .card{background:#fff;border-radius:16px;box-shadow:0 8px 18px rgba(15,34,58,0.08);padding:20px;margin-bottom:20px;}
        label{font-size:12px;color:#555;margin-bottom:3px;display:block;}
        input{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #dde2ef;font-size:13px;outline:none;}
        input:focus{border-color:#1a9bff;box-shadow:0 0 0 3px rgba(26,155,255,0.12);}
        .btn-primary{padding:10px 20px;border:none;border-radius:12px;background:linear-gradient(90deg,#00c853,#1a9bff,#0066ff);color:white;font-weight:600;font-size:14px;cursor:pointer;box-shadow:0 6px 14px rgba(0,102,255,0.25);}
        table{width:100%;border-collapse:collapse;margin-top:10px;}
        th,td{padding:8px;border-bottom:1px solid #eee;text-align:center;}
        th{color:#777;}
        .badge{padding:4px 8px;border-radius:999px;background:#f1f3fa;font-size:12px;}
        .action-icon{cursor:pointer;font-size:16px;}
    </style>
</head>
<body>

<div class="page">

    <div class="top-bar">
        <div class="admin-info">
            <div class="admin-icon">ğŸ› ï¸</div>
            <div>
                <div style="font-weight:700;">Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</div>
                <div style="font-size:12px;color:#777;">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø®ØªØ§Ø± Ù‚Ø§Ø³Ù…</div>
            </div>
        </div>
        <a href="index.html">â¬… Ø±Ø¬ÙˆØ¹ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</a>
    </div>

    <div class="card">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
        <div style="margin-top:10px;">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <input id="username">
            <label style="margin-top:10px;">Ù…Ù„Ø§Ø­Ø¸Ø©</label>
            <input id="note">
            <label style="margin-top:10px;">Ø§Ù„ÙƒÙˆØ¯ (ÙŠØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
            <input id="password" readonly>
            <button class="btn-primary" style="margin-top:15px;" id="addUser">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
        </div>
    </div>

    <div class="card">
        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
        <table>
            <thead>
                <tr>
                    <th>#</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="usersTable"></tbody>
        </table>
    </div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import {
    getFirestore, collection, addDoc, getDocs, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDdiudUa5jjcZDwJgYBbLdC-YBNQ5rlqvU",
    authDomain: "election-system-9cbb8.firebaseapp.com",
    projectId: "election-system-9cbb8",
    storageBucket: "election-system-9cbb8.firebasestorage.app",
    messagingSenderId: "886706894008",
    appId: "1:886706894008:web:270556771843614e56b04d"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const col = collection(db,"systemUsers");

const username = document.getElementById("username");
const note = document.getElementById("note");
const password = document.getElementById("password");
const usersTable = document.getElementById("usersTable");

function generateCode(){
    let L="ABCDEFGHJKLMNPQRSTUVWXYZ",D="0123456789",c="";
    for(let i=0;i<3;i++) c+=L[Math.floor(Math.random()*L.length)];
    for(let i=0;i<2;i++) c+=D[Math.floor(Math.random()*D.length)];
    return c;
}
password.value = generateCode();

async function loadUsers(){
    usersTable.innerHTML="";
    const snap = await getDocs(col);
    let i=1;
    snap.forEach(docu=>{
        let u = docu.data();
        usersTable.innerHTML += `
            <tr>
                <td>${i++}</td>
                <td>${u.username}</td>
                <td><span class="badge">${u.password}</span></td>
                <td>${u.note||""}</td>
                <td><span class="action-icon" onclick="deleteUser('${docu.id}')">ğŸ—‘ï¸</span></td>
            </tr>
        `;
    });
}
loadUsers();

document.getElementById("addUser").onclick = async()=>{
    if(!username.value.trim()){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"); return; }
    await addDoc(col,{
        username: username.value.trim(),
        password: password.value.trim(),
        note: note.value.trim()
    });
    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
    username.value="";
    note.value="";
    password.value=generateCode();
    loadUsers();
};

window.deleteUser = async(id)=>{
    if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ")){
        await deleteDoc(doc(db,"systemUsers",id));
        loadUsers();
    }
};

</script>

</body>
</html>
