<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: #f4f6fb; min-height: 100vh; }
        
        /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginSection { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: #ffffff; border-radius: 18px; box-shadow: 0 18px 40px rgba(15,34,58,0.18); max-width: 380px; width: 100%; padding: 26px 24px 20px; text-align: center; }
        .login-icon { width: 64px; height: 64px; border-radius: 50%; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #fff; background: linear-gradient(135deg, #00c853, #1a9bff); }
        .login-card h1 { font-size: 20px; margin-bottom: 6px; }
        .login-subtitle { font-size: 13px; color: #777; margin-bottom: 16px; }
        .login-form-group { text-align: right; margin-bottom: 12px; }
        .login-form-group label { display: block; font-size: 12px; margin-bottom: 4px; color: #555; }
        .login-form-group input { width: 100%; padding: 9px 10px; border-radius: 10px; border: 1px solid #dde2ef; outline: none; }
        .login-btn { width: 100%; border: none; border-radius: 12px; padding: 10px 0; font-size: 14px; font-weight: 600; cursor: pointer; background: linear-gradient(90deg, #00c853, #1a9bff); color: #fff; margin-top: 4px; }
        .login-hint { margin-top: 10px; font-size: 11px; color: #888; text-align: right; line-height: 1.5; }
        .login-footer { margin-top: 14px; font-size: 11px; color: #999; text-align: center; line-height: 1.6; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #dashboardSection { display: none; }
        .page { max-width: 1200px; margin: 0 auto; padding: 16px 20px 40px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        .user-icon { width: 38px; height: 38px; border-radius: 50%; background: linear-gradient(135deg, #00c853, #1a9bff); display: flex; align-items: center; justify-content: center; color: #fff; }
        .card { background: #fff; border-radius: 16px; box-shadow: 0 8px 18px rgba(15, 34, 58, 0.08); padding: 14px 16px; margin-bottom: 14px; }
        .tabs { display: flex; gap: 18px; border-bottom: 1px solid #e3e6f0; padding-bottom: 8px; margin-bottom: 10px; }
        .tab { cursor: pointer; font-size: 13px; color: #777; }
        .tab.active { color: #00897b; border-bottom: 2px solid #00c853; font-weight: 600; }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-card { background: #fff; border-radius: 16px; padding: 10px 12px; overflow-x: auto; }
        .table-header, .table-row { display: grid; grid-template-columns: 1.5fr 1.2fr 1fr 0.8fr 0.8fr 0.8fr 1fr 0.8fr 0.8fr 0.8fr; gap: 10px; align-items: center; min-width: 900px; }
        .table-header { font-size: 11px; color: #777; border-bottom: 1px solid #edf0f7; padding-bottom: 10px; }
        .table-row { font-size: 12px; padding: 12px 0; border-bottom: 1px solid #f1f3fb; }
        .bool-icon { font-size: 16px; font-weight: bold; }
        .bool-icon.true { color: #2e7d32; }
        .bool-icon.false { color: #c62828; }
        .badge-status { font-size: 10px; padding: 2px 8px; border-radius: 10px; }
        .badge-status.online { background: #e8f5e9; color: #2e7d32; }
        .badge-status.offline { background: #ffeaea; color: #c62828; }

        .add-bar { background: linear-gradient(90deg, #00c853, #1a9bff); border-radius: 12px; padding: 10px; color: #fff; text-align: center; cursor: pointer; margin-bottom: 15px; }
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: #fff; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; }
    </style>
</head>
<body>

<div id="loginSection">
    <div class="login-card">
        <div class="login-icon">ğŸ”</div>
        <h1>Ø¯Ø®ÙˆÙ„ Ù…Ø¯ÙŠØ± / Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
        <p class="login-subtitle">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£Ù‡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.</p>

        <form id="loginForm">
            <div class="login-form-group">
                <label for="loginUser">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="loginUser" placeholder="Ù…Ø«Ø§Ù„: basim01" required>
            </div>
            <div class="login-form-group">
                <label for="loginPass">Ø§Ù„ÙƒÙˆØ¯ / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="loginPass" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡" required>
            </div>
            <button type="submit" class="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </form>

        <div class="login-hint">
            * Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø³Ø§Ø¨ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ù…Ù† Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬.<br>
            * Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·.
        </div>

        <div class="login-footer">
            ÙÙƒØ±Ø© ÙˆØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø®ØªØ§Ø± Ù‚Ø§Ø³Ù…<br>
            07740707073
        </div>
    </div>
</div>

<div id="dashboardSection">
    <div class="page">
        <div class="top-bar">
            <button onclick="location.reload()" style="background:none; border:none; cursor:pointer; font-size:13px; color:#555;">â¬… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            <div style="text-align:right">
                <div style="font-weight:700; font-size:15px;" id="currentUserLabel">Ù…Ø³ØªØ®Ø¯Ù…</div>
                <div style="font-size:12px; color:#777">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            </div>
        </div>

        <div class="card">
            <div class="tabs">
                <div class="tab active">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙŠÙ†</div>
            </div>
            <div class="add-bar" id="addMonitorBtn">Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø§Ù‚Ø¨ Ø¬Ø¯ÙŠØ¯ +</div>
        </div>

        <div class="table-card">
            <div class="table-header">
                <div>Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</div><div>Ø§Ù„Ù…Ø±ÙƒØ²</div><div>Ø§Ù„ÙƒÙˆØ¯</div><div>ÙˆØµÙˆÙ„</div><div>ØªØµÙˆÙŠØª</div><div>Ù…Ø´ÙƒÙ„Ø©</div><div>Ø§Ù„Ø­Ø§Ù„Ø©</div><div>ØµÙˆØ±</div><div>Ù…ÙˆÙ‚Ø¹</div><div>Ø¥Ø¬Ø±Ø§Ø¡</div>
            </div>
            <div id="monitorsBody"></div>
        </div>
    </div>
</div>

<div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
        <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø§Ù‚Ø¨ Ø¬Ø¯ÙŠØ¯</h3><br>
        <form id="addMonitorForm">
            <input type="text" id="mName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;" required>
            <input type="text" id="mCenter" placeholder="Ù…Ø±ÙƒØ² Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¹" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;" required>
            <input type="text" id="mCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" style="width:100%; padding:10px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;" required>
            <button type="submit" class="login-btn">Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</button>
            <button type="button" onclick="closeModal()" style="background:none; color:red; width:100%; border:none; margin-top:5px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </form>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDdiudUa5jjcZDwJgYBbLdC-YBNQ5rlqvU",
        authDomain: "election-system-9cbb8.firebaseapp.com",
        projectId: "election-system-9cbb8",
        storageBucket: "election-system-9cbb8.firebasestorage.app",
        messagingSenderId: "886706894008",
        appId: "1:886706894008:web:270556771843614e56b04d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentAdmin = "";

    document.getElementById('loginForm').onsubmit = (e) => {
        e.preventDefault();
        currentAdmin = document.getElementById('loginUser').value;
        document.getElementById('currentUserLabel').innerText = currentAdmin;
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboardSection').style.display = 'block';
        loadMonitors();
    };

    // Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙ‚Ù†ÙŠ: Ø¯Ù…Ø¬ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø¯Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    function loadMonitors() {
        db.collection('monitors')
          .where('adminUsername', '==', currentAdmin)
          .onSnapshot(snapshot => {
            const body = document.getElementById('monitorsBody');
            body.innerHTML = '';
            snapshot.forEach(doc => {
                const m = doc.data();
                const row = document.createElement('div');
                row.className = 'table-row';
                
                // Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: Ø£Ø®Ø¶Ø± Ø¥Ø°Ø§ Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø¢Ø®Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚
                const isOnline = m.lastUpdate && (Date.now() - m.lastUpdate < 300000);

                row.innerHTML = `
                    <div style="display:flex; align-items:center; gap:5px;">
                        <div style="width:25px; height:25px; background:#1a9bff; color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px;">${(m.monitorName || m.name || "?").charAt(0)}</div>
                        <div>${m.monitorName || m.name}</div>
                    </div>
                    <div>${m.monitorCenter || m.center}</div>
                    <div style="font-family:monospace; background:#eee; padding:2px 5px; border-radius:5px;">${m.code}</div>
                    <div class="bool-icon ${m.arrived ? 'true' : 'false'}">${m.arrived ? 'âœ”' : 'âœ–'}</div>
                    <div class="bool-icon ${m.voted ? 'true' : 'false'}">${m.voted ? 'âœ”' : 'âœ–'}</div>
                    <div class="bool-icon ${m.issueMessage ? 'true' : 'false'}">${m.issueMessage ? 'âš ' : 'â€”'}</div>
                    <div><span class="badge-status ${isOnline ? 'online' : 'offline'}">${isOnline ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</span></div>
                    <div>${m.hasPhoto || (m.photoList && m.photoList.length > 0) ? 'ğŸ“·' : 'â€”'}</div>
                    <div>${m.location || m.hasLocation ? 'ğŸ“' : 'â€”'}</div>
                    <div onclick="deleteMonitor('${doc.id}')" style="cursor:pointer; color:red;">ğŸ—‘ï¸</div>
                `;
                body.appendChild(row);
            });
        });
    }

    document.getElementById('addMonitorBtn').onclick = () => document.getElementById('modalBackdrop').style.display = 'flex';
    function closeModal() { document.getElementById('modalBackdrop').style.display = 'none'; }
    
    document.getElementById('addMonitorForm').onsubmit = async (e) => {
        e.preventDefault();
        const data = {
            monitorName: document.getElementById('mName').value,
            monitorCenter: document.getElementById('mCenter').value,
            code: document.getElementById('mCode').value,
            adminUsername: currentAdmin,
            arrived: false,
            voted: false,
            lastUpdate: Date.now()
        };
        await db.collection('monitors').add(data);
        closeModal();
        e.target.reset();
    };

    async function deleteMonitor(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ØŸ")) await db.collection('monitors').doc(id).delete();
    }
</script>
</body>
</html>
