<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ - Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #1a9bff;
            --accent: #00c853;
            --card-radius: 22px;
            --shadow: 0 20px 40px rgba(15, 34, 58, 0.18);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Cairo', sans-serif;
            min-height: 100vh;
            background: radial-gradient(circle at top left,#e0f2ff 0,#f7fbff 40%,#e6fff4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #loginSection {
            width: 100%;
            max-width: 420px;
            padding: 22px;
        }

        .card {
            background: #fff;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            padding: 32px 28px 24px;
            text-align: center;
        }

        .icon-circle {
            width: 72px;
            height: 72px;
            margin: 0 auto 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg,#00c853,#1a9bff);
            color: #fff;
            font-size: 34px;
        }

        h1 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .subtitle { color: #777; margin-bottom: 24px; font-size: 14px; }

        .form-group { text-align: right; margin-bottom: 16px; }
        label { font-size: 13px; color: #555; margin-bottom: 6px; display: block; }

        .input-wrapper { position: relative; }
        .input-wrapper input {
            width: 100%; padding: 11px 40px 11px 12px;
            border-radius: 12px; border: 1px solid #dde3ee;
            font-size: 14px;
        }

        .input-icon {
            position: absolute; right: 12px; top: 50%;
            transform: translateY(-50%);
            font-size: 18px; color: #9aa4bc;
        }

        button.primary {
            width: 100%; padding: 11px 0; font-weight: 600;
            border: none; border-radius: 12px;
            background: linear-gradient(90deg,#00c853,#1a9bff,#0066ff);
            color: #fff; cursor: pointer;
        }

        .error { margin-top: 10px; color: #d32f2f; display: none; font-size: 13px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ */
        #monitorSection { display: none; max-width: 460px; padding: 20px; width: 100%; }

        .btn-action {
            width: 100%; padding: 12px 0;
            border-radius: 14px; font-size: 15px; font-weight: 600;
            color: #fff; cursor: pointer; margin-bottom: 10px;
        }

        .btn-arrived { background: linear-gradient(90deg,#00c853,#4caf50); }
        .btn-voted { background: linear-gradient(90deg,#1a9bff,#0066ff); }
        .btn-issue { background: linear-gradient(90deg,#ff9800,#f44336); }
        .btn-loc { background: linear-gradient(90deg,#ff9800,#ff5722); }

        .status-box { margin-top: 12px; font-size: 12px; text-align: right; line-height: 1.7; color: #444; }

        #logoutBtn {
            width: 100%; padding: 10px 0;
            margin-top: 10px;
            background: #eee; border: none; border-radius: 12px;
            cursor: pointer; font-weight: 600;
        }
    </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginSection">
    <div class="card">
        <div class="icon-circle">ğŸ‘¤</div>
        <h1>Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª</h1>
        <p class="subtitle">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</p>

        <form id="monitorLoginForm">
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</label>
                <div class="input-wrapper">
                    <span class="input-icon">ğŸ‘¤</span>
                    <input id="monitorName" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
            </div>

            <div class="form-group">
                <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</label>
                <div class="input-wrapper">
                    <span class="input-icon">ğŸ”‘</span>
                    <input id="monitorCode" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯" required>
                </div>
            </div>

            <button class="primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="loginError" class="error"></div>
        </form>
    </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ -->
<div id="monitorSection">
    <div class="card">
        <h2 style="margin-bottom:8px;">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</h2>
        <p style="font-size:13px;color:#777;">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="nameLabel">Ù…Ø±Ø§Ù‚Ø¨</span> â€“ ÙƒÙˆØ¯Ùƒ: <b id="codeLabel"></b>
        </p>

        <button id="btnArrived" class="btn-action btn-arrived">ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„</button>
        <button id="btnVoted" class="btn-action btn-voted">ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª</button>
        <button id="btnIssue" class="btn-action btn-issue">Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø©</button>

        <button id="btnLocation" class="btn-action btn-loc">ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</button>

        <div class="status-box" id="statusBox">
            <div><b>Ø§Ù„ÙˆØµÙˆÙ„:</b> â€”</div>
            <div><b>Ø§Ù„ØªØµÙˆÙŠØª:</b> â€”</div>
            <div><b>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</b> â€”</div>
            <div><b>Ø¢Ø®Ø± Ù…ÙˆÙ‚Ø¹:</b> Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>
        </div>

        <button id="logoutBtn">â¬… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDdiudUa5jjcZDwJgYBbLdC-YBNQ5rlqvU",
        authDomain: "election-system-9cbb8.firebaseapp.com",
        projectId: "election-system-9cbb8",
        storageBucket: "election-system-9cbb8.firebasestorage.app",
        messagingSenderId: "886706894008",
        appId: "1:886706894008:web:270556771843614e56b04d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const loginSection = document.getElementById("loginSection");
    const monitorSection = document.getElementById("monitorSection");

    const btnArrived = document.getElementById("btnArrived");
    const btnVoted = document.getElementById("btnVoted");
    const btnIssue = document.getElementById("btnIssue");
    const btnLocation = document.getElementById("btnLocation");

    let currentCode = null;
    let monitorDocId = null;

    function updateUI(arrived, voted, issue, location) {
        const box = document.getElementById("statusBox").children;
        box[0].innerHTML = "<b>Ø§Ù„ÙˆØµÙˆÙ„:</b> " + (arrived ? "âœ”" : "â€”");
        box[1].innerHTML = "<b>Ø§Ù„ØªØµÙˆÙŠØª:</b> " + (voted ? "ğŸ“Œ" : "â€”");
        box[2].innerHTML = "<b>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</b> " + (issue ? "âš " : "â€”");
        box[3].innerHTML = "<b>Ø¢Ø®Ø± Ù…ÙˆÙ‚Ø¹:</b> " + (location ? location.lat.toFixed(5) + ", " + location.lng.toFixed(5) : "Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById("monitorLoginForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const code = document.getElementById("monitorCode").value.trim();

        const snap = await db.collection("monitors").where("code", "==", code).limit(1).get();

        if (snap.empty) {
            loginError.textContent = "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.";
            loginError.style.display = "block";
            return;
        }

        loginError.style.display = "none";

        const doc = snap.docs[0];
        monitorDocId = doc.id;
        currentCode = code;

        const data = doc.data();

        loginSection.style.display = "none";
        monitorSection.style.display = "block";

        document.getElementById("nameLabel").textContent = data.monitorName || "Ù…Ø±Ø§Ù‚Ø¨";
        document.getElementById("codeLabel").textContent = code;

        updateUI(data.arrived, data.voted, data.hasIssue, data.location);

        db.collection("monitors").doc(monitorDocId).update({ online: true });
    });

    btnArrived.addEventListener("click", () => {
        db.collection("monitors").doc(monitorDocId).update({ arrived: true });
        updateUI(true, false, false);
    });

    btnVoted.addEventListener("click", () => {
        db.collection("monitors").doc(monitorDocId).update({ voted: true });
        updateUI(false, true, false);
    });

    btnIssue.addEventListener("click", () => {
        db.collection("monitors").doc(monitorDocId).update({ hasIssue: true });
        updateUI(false, false, true);
    });

    btnLocation.addEventListener("click", () => {
        navigator.geolocation.getCurrentPosition((pos) => {
            const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            db.collection("monitors").doc(monitorDocId).update({ location: loc });
            updateUI(false, false, false, loc);
        });
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
        db.collection("monitors").doc(monitorDocId).update({ online: false });
        monitorSection.style.display = "none";
        loginSection.style.display = "block";
    });
</script>

</body>
</html>
