<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ - Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary:#1a9bff;
            --accent:#00c853;
            --radius:18px;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Cairo', sans-serif;
            background:#f5faff;
            display:flex;
            justify-content:center;
            align-items:center;
            min-height:100vh;
        }

        #loginSection, #monitorSection { width:100%; max-width:420px; padding:20px; }

        .card {
            background:#fff;
            padding:24px;
            border-radius:var(--radius);
            box-shadow:0 10px 25px rgba(0,0,0,0.08);
        }

        .icon {
            font-size:42px;
            width:70px;
            height:70px;
            display:flex;
            justify-content:center;
            align-items:center;
            margin:0 auto 10px;
            border-radius:50%;
            color:#fff;
            background:linear-gradient(135deg,#00c853,#1a9bff);
        }

        label { font-size:13px; display:block; margin-bottom:4px; color:#555; }

        input {
            width:100%;
            padding:10px;
            border-radius:10px;
            border:1px solid #ccc;
            margin-bottom:12px;
            font-size:14px;
        }

        button {
            width:100%;
            padding:10px;
            border:none;
            border-radius:12px;
            color:#fff;
            cursor:pointer;
            font-size:15px;
            background:linear-gradient(90deg,#00c853,#1a9bff,#0066ff);
        }

        .btn-action {
            margin-bottom:10px;
            padding:12px;
            border-radius:12px;
            font-size:15px;
            color:#fff;
            border:none;
            cursor:pointer;
        }

        .btn-arrived { background:#00c853; }
        .btn-voted { background:#0066ff; }
        .btn-issue { background:#ff9800; }
        .btn-loc { background:#ff5722; }

        .inactive { opacity:0.5; }

        .status-box { margin-top:12px; font-size:13px; line-height:1.6; }
        .status-box span { font-weight:bold; }

        #logoutBtn {
            margin-top:10px;
            background:#ddd;
            color:#333;
        }
    </style>
</head>

<body>

<!-- Ø¯Ø®ÙˆÙ„ -->
<div id="loginSection">
    <div class="card">
        <div class="icon">ðŸ‘¤</div>
        <h2 style="text-align:center;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</h2>

        <form id="loginForm">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</label>
            <input id="monitorName">

            <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</label>
            <input id="monitorCode" required type="password">

            <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </form>

        <p id="loginError" style="color:red;display:none;text-align:center;margin-top:8px;">
            Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­
        </p>
    </div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ -->
<div id="monitorSection" style="display:none;">
    <div class="card">

        <h3 style="text-align:center;">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</h3>
        <p style="text-align:center;">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="wName"></span> â€” ÙƒÙˆØ¯Ùƒ:
            <b id="wCode"></b>
        </p>

        <button class="btn-action btn-arrived" id="btnArrived">ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„</button>
        <button class="btn-action btn-voted" id="btnVoted">ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª</button>
        <button class="btn-action btn-issue" id="btnIssue">Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø©</button>
        <button class="btn-action btn-loc" id="btnLocation">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>

        <div class="status-box" id="statusBox">
            <div><span>Ø§Ù„ÙˆØµÙˆÙ„:</span> â€”</div>
            <div><span>Ø§Ù„ØªØµÙˆÙŠØª:</span> â€”</div>
            <div><span>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</span> â€”</div>
            <div><span>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span> â€”</div>
        </div>

        <button id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDdiudUa5jjcZDwJgYBbLdC-YBNQ5rlqvU",
    authDomain: "election-system-9cbb8.firebaseapp.com",
    projectId: "election-system-9cbb8",
    storageBucket: "election-system-9cbb8.firebasestorage.app",
    messagingSenderId: "886706894008",
    appId: "1:886706894008:web:270556771843614e56b04d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let monitorID = null;
let monitorCode = null;

function updateUI(status) {
    const box = document.getElementById("statusBox").children;

    box[0].innerHTML = "<span>Ø§Ù„ÙˆØµÙˆÙ„:</span> " + (status.arrived ? "âœ”" : "â€”");
    box[1].innerHTML = "<span>Ø§Ù„ØªØµÙˆÙŠØª:</span> " + (status.voted ? "âœ”" : "â€”");
    box[2].innerHTML = "<span>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</span> " + (status.hasIssue ? "âš " : "â€”");
    box[3].innerHTML = "<span>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span> " + (status.location ? "ðŸ“" : "â€”");
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById("loginForm").addEventListener("submit", async (e)=>{
    e.preventDefault();

    const code = document.getElementById("monitorCode").value;

    const snap = await db.collection("monitors").where("code","==",code).limit(1).get();

    if (snap.empty) {
        loginError.style.display = "block";
        return;
    }

    loginError.style.display = "none";

    const doc = snap.docs[0];
    monitorID = doc.id;
    monitorCode = code;

    let nameInput = document.getElementById("monitorName").value;
    if (!nameInput) nameInput = doc.data().monitorName || "Ù…Ø±Ø§Ù‚Ø¨";

    document.getElementById("wName").textContent = nameInput;
    document.getElementById("wCode").textContent = code;

    db.collection("monitors").doc(monitorID).update({
        online: true
    });

    loginSection.style.display="none";
    monitorSection.style.display="block";

    updateUI(doc.data());
});

// ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„
btnArrived.onclick = ()=>{
    db.collection("monitors").doc(monitorID).update({ arrived:true });
    updateUI({ arrived:true, voted:false, hasIssue:false, location:null });
};

// ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª
btnVoted.onclick = ()=>{
    db.collection("monitors").doc(monitorID).update({ voted:true });
    updateUI({ arrived:true, voted:true, hasIssue:false, location:null });
};

// Ø¥Ø±Ø³Ø§Ù„ Ù…Ø´ÙƒÙ„Ø©
btnIssue.onclick = ()=>{
    db.collection("monitors").doc(monitorID).update({
        hasIssue:true,
        issueText:"Ù…Ø´ÙƒÙ„Ø© Ù…Ø¨Ù„Ù‘ØºØ©"
    });
    updateUI({ arrived:false, voted:false, hasIssue:true, location:null });
};

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
btnLocation.onclick = ()=>{
    navigator.geolocation.getCurrentPosition((pos)=>{
        db.collection("monitors").doc(monitorID).update({
            location:{
                lat:pos.coords.latitude,
                lng:pos.coords.longitude
            }
        });
        updateUI({ arrived:false, voted:false, hasIssue:false, location:true });
    });
};

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
logoutBtn.onclick = ()=>{
    db.collection("monitors").doc(monitorID).update({
        online:false
    });
    location.reload();
};
</script>

</body>
</html>
